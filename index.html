<!DOCTYPE html>
<html>
<head>
    <title>blender.js</title>
    <script type="text/javascript" src="blender.js"></script>
    <style>
        canvas {
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div style="float: left; width: 250px"><h2>Source</h2><img id="src" src="duck.png" /></div>
    <div style="float: left; width: 250px"><h2>Destination</h2><img id="dst" src="gradient.png" /></div>
    <div id="results" style="clear: both; float: left; width: 250px"><h2>Results</h2></div>
    <div id="expected" style="float: left; width: 250px"><h2>Expected</h2></div>
    <script>
        var src = document.getElementById('src');
        var dst = document.getElementById('dst');
        var results = document.getElementById('results');
        var expected = document.getElementById('expected');
        var tests = [
            'normal',
            'multiply',
            'screen',
            'overlay',
            'darken',
            'lighten',
            'color-dodge',
            'color-burn',
            'hard-light',
            'soft-light',
            'difference',
            'exclusion'
        ];

        function runTests() {
            tests.forEach(function (blendMode) {
                console.log('Running test: '+blendMode);
                console.time(blendMode);
                var canvas = document.createElement('canvas');
                var srcCanvas = document.createElement('canvas');
                var title = document.createElement('h3');
                var container = document.createElement('div');
                title.innerHTML = blendMode;
                container.appendChild(title);
                var containerExpected = container.cloneNode(true);
                var expectedImg = new Image();
                expectedImg.src = blendMode+'.png';
                containerExpected.appendChild(expectedImg);
                container.appendChild(canvas);
                results.appendChild(container);
                expected.appendChild(containerExpected);

                container.style.height=containerExpected.style.height = '300px';

                srcCanvas.width = src.width;
                srcCanvas.height = src.height;
                canvas.width = Math.max(src.width, dst.width);
                canvas.height = Math.max(src.height, dst.height);
                var srcCtx = srcCanvas.getContext('2d');
                var dstCtx = canvas.getContext('2d');
                srcCtx.drawImage(src, 0, 0);
                dstCtx.drawImage(dst, 0, 0);
                Blender.blendOnto(srcCtx, dstCtx, blendMode);
            });
        }

        function drawGradients(ctx) {
            var grad = ctx.createLinearGradient(10, 0, 390, 0);
            grad.addColorStop(0, 'red');
            grad.addColorStop(1 / 6, 'orange');
            grad.addColorStop(2 / 6, 'yellow');
            grad.addColorStop(3 / 6, 'green')
            grad.addColorStop(4 / 6, 'aqua');
            grad.addColorStop(5 / 6, 'blue');
            grad.addColorStop(1, 'purple');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
        }

        window.onload = runTests;
    </script>
</body>
</html>
